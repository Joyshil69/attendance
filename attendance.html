<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Attendance Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-btn.active {
            background: white;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
        }

        .tab-btn:hover:not(.active) {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.3);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.8rem;
        }

        .attendance-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #6c757d;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .table th {
            background: #2c3e50;
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .table td {
            padding: 15px 10px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9rem;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .status-present {
            background: #27ae60;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-absent {
            background: #e74c3c;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-late {
            background: #f39c12;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-leave {
            background: #9b59b6;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-week-off {
            background: #95a5a6;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .search-filter {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .time-display {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #2c3e50;
        }

        .current-time {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #27ae60;
        }

        .leave-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .working-hours {
            font-weight: bold;
            color: #3498db;
        }

        .overtime {
            color: #e67e22;
            font-weight: bold;
        }

        .undertime {
            color: #e74c3c;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .attendance-form {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .table th, .table td {
                padding: 10px 8px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üïê Advanced Attendance System</h1>
            <p>Comprehensive attendance tracking with time management</p>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('check-inout')">Check In/Out</button>
            <button class="tab-btn" onclick="showTab('mark-attendance')">Mark Attendance</button>
            <button class="tab-btn" onclick="showTab('leave-management')">Leave Management</button>
            <button class="tab-btn" onclick="showTab('view-records')">View Records</button>
            <button class="tab-btn" onclick="showTab('manage-students')">Manage Students</button>
            <button class="tab-btn" onclick="showTab('reports')">Reports</button>
            <button class="tab-btn" onclick="showTab('settings')">Settings</button>
        </div>

        <!-- Check In/Out Tab -->
        <div id="check-inout" class="tab-content active">
            <h2>Check In / Check Out</h2>
            
            <div class="current-time" id="current-time"></div>
            
            <div id="alert-container"></div>
            
            <div class="attendance-form">
                <div class="form-group">
                    <label for="checkin-date">Date:</label>
                    <input type="date" id="checkin-date" class="form-control">
                </div>
                <div class="form-group">
                    <label for="checkin-student">Select Student:</label>
                    <select id="checkin-student" class="form-control">
                        <option value="">Select Student</option>
                    </select>
                </div>
            </div>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <button class="btn btn-success" onclick="checkIn()">Check In</button>
                <button class="btn btn-warning" onclick="checkOut()">Check Out</button>
                <button class="btn btn-info" onclick="markBreak()">Break</button>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Check-in</th>
                            <th>Check-out</th>
                            <th>Break Time</th>
                            <th>Total Hours</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="checkin-table">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Mark Attendance Tab -->
        <div id="mark-attendance" class="tab-content">
            <h2>Mark Attendance</h2>
            
            <div class="attendance-form">
                <div class="form-group">
                    <label for="attendance-date">Date:</label>
                    <input type="date" id="attendance-date" class="form-control">
                </div>
                <div class="form-group">
                    <label for="attendance-class">Class/Subject:</label>
                    <input type="text" id="attendance-class" class="form-control" placeholder="e.g., Mathematics 101">
                </div>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Student ID</th>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="attendance-table">
                    </tbody>
                </table>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="saveAttendance()">Save Attendance</button>
                <button class="btn btn-primary" onclick="markAllPresent()">Mark All Present</button>
                <button class="btn btn-danger" onclick="markAllAbsent()">Mark All Absent</button>
            </div>
        </div>

        <!-- Leave Management Tab -->
        <div id="leave-management" class="tab-content">
            <h2>Leave Management</h2>
            
            <div class="leave-form">
                <h3>Apply for Leave</h3>
                <div class="attendance-form">
                    <div class="form-group">
                        <label for="leave-student">Student:</label>
                        <select id="leave-student" class="form-control">
                            <option value="">Select Student</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="leave-type">Leave Type:</label>
                        <select id="leave-type" class="form-control">
                            <option value="sick">Sick Leave</option>
                            <option value="casual">Casual Leave</option>
                            <option value="emergency">Emergency Leave</option>
                            <option value="personal">Personal Leave</option>
                            <option value="vacation">Vacation</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="leave-from">From Date:</label>
                        <input type="date" id="leave-from" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="leave-to">To Date:</label>
                        <input type="date" id="leave-to" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="leave-reason">Reason:</label>
                        <textarea id="leave-reason" class="form-control" rows="3" placeholder="Enter reason for leave"></textarea>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="applyLeave()">Apply Leave</button>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Leave Type</th>
                            <th>From Date</th>
                            <th>To Date</th>
                            <th>Days</th>
                            <th>Reason</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="leave-table">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- View Records Tab -->
        <div id="view-records" class="tab-content">
            <h2>Attendance Records</h2>
            
            <div class="search-filter">
                <div class="form-group">
                    <label for="filter-student">Filter by Student:</label>
                    <select id="filter-student" class="form-control" onchange="filterRecords()">
                        <option value="">All Students</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filter-date-from">From Date:</label>
                    <input type="date" id="filter-date-from" class="form-control" onchange="filterRecords()">
                </div>
                <div class="form-group">
                    <label for="filter-date-to">To Date:</label>
                    <input type="date" id="filter-date-to" class="form-control" onchange="filterRecords()">
                </div>
                <div class="form-group">
                    <label for="filter-status">Filter by Status:</label>
                    <select id="filter-status" class="form-control" onchange="filterRecords()">
                        <option value="">All Status</option>
                        <option value="present">Present</option>
                        <option value="absent">Absent</option>
                        <option value="late">Late</option>
                        <option value="leave">Leave</option>
                        <option value="week-off">Week Off</option>
                    </select>
                </div>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Student</th>
                            <th>Check-in</th>
                            <th>Check-out</th>
                            <th>Total Hours</th>
                            <th>Status</th>
                            <th>Class/Subject</th>
                        </tr>
                    </thead>
                    <tbody id="records-table">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Manage Students Tab -->
        <div id="manage-students" class="tab-content">
            <h2>Manage Students</h2>
            
            <div class="attendance-form">
                <div class="form-group">
                    <label for="student-id">Student ID:</label>
                    <input type="text" id="student-id" class="form-control" placeholder="e.g., STU001">
                </div>
                <div class="form-group">
                    <label for="student-name">Student Name:</label>
                    <input type="text" id="student-name" class="form-control" placeholder="e.g., John Doe">
                </div>
                <div class="form-group">
                    <label for="student-email">Email:</label>
                    <input type="email" id="student-email" class="form-control" placeholder="e.g., john@example.com">
                </div>
                <div class="form-group">
                    <label for="student-department">Department:</label>
                    <input type="text" id="student-department" class="form-control" placeholder="e.g., Computer Science">
                </div>
            </div>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <button class="btn btn-primary" onclick="addStudent()">Add Student</button>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Student ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Department</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="students-table">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2>Attendance Reports</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-students">0</div>
                    <div class="stat-label">Total Students</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-records">0</div>
                    <div class="stat-label">Total Records</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="average-attendance">0%</div>
                    <div class="stat-label">Average Attendance</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="present-today">0</div>
                    <div class="stat-label">Present Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-leaves">0</div>
                    <div class="stat-label">Total Leaves</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avg-hours">0h</div>
                    <div class="stat-label">Avg Hours/Day</div>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Total Days</th>
                            <th>Present</th>
                            <th>Absent</th>
                            <th>Late</th>
                            <th>Leaves</th>
                            <th>Avg Hours</th>
                            <th>Attendance %</th>
                        </tr>
                    </thead>
                    <tbody id="report-table">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h2>System Settings</h2>
            
            <div class="attendance-form">
                <div class="form-group">
                    <label for="work-start-time">Work Start Time:</label>
                    <input type="time" id="work-start-time" class="form-control" value="09:00">
                </div>
                <div class="form-group">
                    <label for="work-end-time">Work End Time:</label>
                    <input type="time" id="work-end-time" class="form-control" value="17:00">
                </div>
                <div class="form-group">
                    <label for="late-threshold">Late Threshold (minutes):</label>
                    <input type="number" id="late-threshold" class="form-control" value="15" min="0">
                </div>
                <div class="form-group">
                    <label for="week-offs">Week Off Days:</label>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <label><input type="checkbox" id="sunday" checked> Sunday</label>
                        <label><input type="checkbox" id="monday"> Monday</label>
                        <label><input type="checkbox" id="tuesday"> Tuesday</label>
                        <label><input type="checkbox" id="wednesday"> Wednesday</label>
                        <label><input type="checkbox" id="thursday"> Thursday</label>
                        <label><input type="checkbox" id="friday"> Friday</label>
                        <label><input type="checkbox" id="saturday"> Saturday</label>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                <button class="btn btn-warning" onclick="exportData()">Export Data</button>
                <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let students = [];
        let attendanceRecords = [];
        let leaveRecords = [];
        let checkInOutRecords = [];
        let settings = {
            workStartTime: '09:00',
            workEndTime: '17:00',
            lateThreshold: 15,
            weekOffs: [0] // Sunday = 0
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            document.getElementById('attendance-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('checkin-date').value = new Date().toISOString().split('T')[0];
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            refreshAllTables();
        });

        // Time utilities
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = 
                `Current Time: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
        }

        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function calculateHours(startTime, endTime) {
            if (!startTime || !endTime) return '0:00';
            const start = new Date(`1970-01-01T${startTime}`);
            const end = new Date(`1970-01-01T${endTime}`);
            const diff = (end - start) / 1000 / 60; // minutes
            const hours = Math.floor(diff / 60);
            const minutes = Math.floor(diff % 60);
            return `${hours}:${minutes.toString().padStart(2, '0')}`;
        }

        function isLate(checkInTime) {
            const checkIn = new Date(`1970-01-01T${checkInTime}`);
            const workStart = new Date(`1970-01-01T${settings.workStartTime}`);
            const diffMinutes = (checkIn - workStart) / 1000 / 60;
            return diffMinutes > settings.lateThreshold;
        }

        function isWeekOff(date) {
            const dayOfWeek = new Date(date).getDay();
            return settings.weekOffs.includes(dayOfWeek);
        }

        // Tab functionality
        function showTab(tabId) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            refreshAllTables();
        }

        // Check In/Out functionality
        function checkIn() {
            const date = document.getElementById('checkin-date').value;
            const studentId = document.getElementById('checkin-student').value;
            
            if (!date || !studentId) {
                showAlert('Please select date and student', 'error');
                return;
            }
            
            if (isWeekOff(date)) {
                showAlert('Cannot check in on week off day', 'error');
                return;
            }
            
            const existing = checkInOutRecords.find(r => 
                r.studentId === studentId && r.date === date
            );
            
            if (existing && existing.checkIn) {
                showAlert('Student already checked in today', 'error');
                return;
            }
            
            const now = new Date();
            const checkInTime = formatTime(now);
            
            if (existing) {
                existing.checkIn = checkInTime;
            } else {
                checkInOutRecords.push({
                    studentId: studentId,
                    date: date,
                    checkIn: checkInTime,
                    checkOut: null,
                    breakTime: 0,
                    status: isLate(checkInTime) ? 'late' : 'present'
                });
            }
            
            refreshCheckInTable();
            showAlert('Check in successful', 'success');
        }

        function checkOut() {
            const date = document.getElementById('checkin-date').value;
            const studentId = document.getElementById('checkin-student').value;
            
            if (!date || !studentId) {
                showAlert('Please select date and student', 'error');
                return;
            }
            
            const record = checkInOutRecords.find(r => 
                r.studentId === studentId && r.date === date
            );
            
            if (!record || !record.checkIn) {
                showAlert('Student must check in first', 'error');
                return;
            }
            
            if (record.checkOut) {
                showAlert('Student already checked out today', 'error');
                return;
            }
            
            const now = new Date();
            record.checkOut = formatTime(now);
            
            refreshCheckInTable();
            showAlert('Check out successful', 'success');
        }

        function markBreak() {
            const date = document.getElementById('checkin-date').value;
            const studentId = document.getElementById('checkin-student').value;
            
            if (!date || !studentId) {
                showAlert('Please select date and student', 'error');
                return;
            }
            
            const record = checkInOutRecords.find(r => 
                r.studentId === studentId && r.date === date
            );
            
            if (!record || !record.checkIn) {
                showAlert('Student must check in first', 'error');
                return;
            }
            
            const breakMinutes = prompt('Enter break duration in minutes:', '30');
            if (breakMinutes && !isNaN(breakMinutes)) {
                record.breakTime = (record.breakTime || 0) + parseInt(breakMinutes);
                refreshCheckInTable();
                showAlert(`Break of ${breakMinutes} minutes added`, 'success');
            }
        }

        // Student management
        function addStudent() {
            const studentId = document.getElementById('student-id').value.trim();
            const studentName = document.getElementById('student-name').value.trim();
            const studentEmail = document.getElementById('student-email').value.trim();
            const studentDept = document.getElementById('student-department').value.trim();
            
            if (!studentId || !studentName) {
                showAlert('Please fill in Student ID and Name', 'error');
                return;
            }
            
            if (students.find(s => s.id === studentId)) {
                showAlert('Student ID already exists', 'error');
                return;
            }
            
            students.push({ 
                id: studentId, 
                name: studentName,
                email: studentEmail,
                department: studentDept
            });
            
            saveData();
            refreshAllTables();
            
            // Clear form
            document.getElementById('student-id').value = '';
            document.getElementById('student-name').value = '';
            document.getElementById('student-email').value = '';
            document.getElementById('student-department').value = '';
            
            showAlert('Student added successfully', 'success');
        }

        function deleteStudent(studentId) {
            if (confirm('Are you sure you want to delete this student? This will also delete all their records.')) {
                students = students.filter(s => s.id !== studentId);
                attendanceRecords = attendanceRecords.filter(r => r.studentId !== studentId);
                checkInOutRecords = checkInOutRecords.filter(r => r.studentId !== studentId);
                leaveRecords = leaveRecords.filter(r => r.studentId !== studentId);
                saveData();
                refreshAllTables();
                showAlert('Student deleted successfully', 'success');
            }
        }

        // Leave management
        function applyLeave() {
            const studentId = document.getElementById('leave-student').value;
            const leaveType = document.getElementById('leave-type').value;
            const fromDate = document.getElementById('leave-from').value;
            const toDate = document.getElementById('leave-to').value;
            const reason = document.getElementById('leave-reason').value.trim();
            
            if (!studentId || !fromDate || !toDate || !reason) {
                showAlert('Please fill in all fields', 'error');
                return;
            }
            
            if (new Date(fromDate) > new Date(toDate)) {
                showAlert('From date cannot be after to date', 'error');
                return;
            }
            
            const daysDiff = Math.ceil((new Date(toDate) - new Date(fromDate)) / (1000 * 60 * 60 * 24)) + 1;
            
            leaveRecords.push({
                id: Date.now().toString(),
                studentId: studentId,
                leaveType: leaveType,
                fromDate: fromDate,
                toDate: toDate,
                days: daysDiff,
                reason: reason,
                status: 'pending',
                appliedDate: new Date().toISOString().split('T')[0]
            });
            
            // Auto-create attendance records for leave days
            const currentDate = new Date(fromDate);
            while (currentDate <= new Date(toDate)) {
                const dateStr = currentDate.toISOString().split('T')[0];
                if (!isWeekOff(dateStr)) {
                    const existing = attendanceRecords.find(r => 
                        r.studentId === studentId && r.date === dateStr
                    );
                    
                    if (!existing) {
                        attendanceRecords.push({
                            studentId: studentId,
                            date: dateStr,
                            class: 'Leave',
                            status: 'leave',
                            timestamp: new Date().toISOString()
                        });
                    }
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            saveData();
            refreshAllTables();
            
            // Clear form
            document.getElementById('leave-student').value = '';
            document.getElementById('leave-reason').value = '';
            
            showAlert('Leave application submitted', 'success');
        }

        function approveLeave(leaveId) {
            const leave = leaveRecords.find(l => l.id === leaveId);
            if (leave) {
                leave.status = 'approved';
                refreshLeaveTable();
                showAlert('Leave approved', 'success');
            }
        }

        function rejectLeave(leaveId) {
            const leave = leaveRecords.find(l => l.id === leaveId);
            if (leave) {
                leave.status = 'rejected';
                // Remove auto-created attendance records
                attendanceRecords = attendanceRecords.filter(r => 
                    !(r.studentId === leave.studentId && 
                      r.date >= leave.fromDate && 
                      r.date <= leave.toDate && 
                      r.status === 'leave')
                );
                refreshAllTables();
                showAlert('Leave rejected', 'success');
            }
        }

        // Attendance management
        function markAttendance(studentId, status) {
            const date = document.getElementById('attendance-date').value;
            const className = document.getElementById('attendance-class').value.trim();
            
            if (!date || !className) {
                showAlert('Please fill in date and class/subject', 'error');
                return;
            }
            
            if (isWeekOff(date)) {
                status = 'week-off';
            }
            
            let record = attendanceRecords.find(r => 
                r.studentId === studentId && r.date === date && r.class === className
            );
            
            if (record) {
                record.status = status;
            } else {
                attendanceRecords.push({
                    studentId: studentId,
                    date: date,
                    class: className,
                    status: status,
                    timestamp: new Date().toISOString()
                });
            }
            
            refreshAttendanceTable();
        }

        function markAllPresent() {
            students.forEach(student => {
                markAttendance(student.id, 'present');
            });
            showAlert('All students marked present', 'success');
        }

        function markAllAbsent() {
            students.forEach(student => {
                markAttendance(student.id, 'absent');
            });
            showAlert('All students marked absent', 'success');
        }

        function saveAttendance() {
            saveData();
            showAlert('Attendance saved successfully', 'success');
            refreshAllTables();
        }

        // Table refresh functions
        function refreshCheckInTable() {
            const tbody = document.getElementById('checkin-table');
            const date = document.getElementById('checkin-date').value;
            
            tbody.innerHTML = '';
            
            // Update student dropdown
            const studentSelect = document.getElementById('checkin-student');
            studentSelect.innerHTML = '<option value="">Select Student</option>';
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} (${student.id})`;
                studentSelect.appendChild(option);
            });
            
            students.forEach(student => {
                const record = checkInOutRecords.find(r => 
                    r.studentId === student.id && r.date === date
                );
                
                let status = 'absent';
                let checkIn = '-';
                let checkOut = '-';
                let breakTime = '0 min';
                let totalHours = '0:00';
                
                if (record) {
                    status = record.status || 'present';
                    checkIn = record.checkIn || '-';
                    checkOut = record.checkOut || '-';
                    breakTime = `${record.breakTime || 0} min`;
                    
                    if (record.checkIn && record.checkOut) {
                        const totalMinutes = calculateTotalMinutes(record.checkIn, record.checkOut, record.breakTime || 0);
                        totalHours = formatMinutesToHours(totalMinutes);
                    }
                }
                
                if (isWeekOff(date)) {
                    status = 'week-off';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.name} (${student.id})</td>
                    <td class="time-display">${checkIn}</td>
                    <td class="time-display">${checkOut}</td>
                    <td>${breakTime}</td>
                    <td class="working-hours">${totalHours}</td>
                    <td><span class="status-${status}">${status.charAt(0).toUpperCase() + status.slice(1).replace('-', ' ')}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function refreshAttendanceTable() {
            const tbody = document.getElementById('attendance-table');
            const date = document.getElementById('attendance-date').value;
            const className = document.getElementById('attendance-class').value.trim();
            
            tbody.innerHTML = '';
            
            students.forEach(student => {
                const existingRecord = attendanceRecords.find(r => 
                    r.studentId === student.id && r.date === date && r.class === className
                );
                
                let status = 'absent';
                if (isWeekOff(date)) {
                    status = 'week-off';
                } else if (existingRecord) {
                    status = existingRecord.status;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td><span class="status-${status}">${status.charAt(0).toUpperCase() + status.slice(1).replace('-', ' ')}</span></td>
                    <td>
                        <button class="btn btn-small ${status === 'present' ? 'btn-success' : 'btn-primary'}" 
                                onclick="markAttendance('${student.id}', 'present')"
                                ${status === 'present' ? 'style="opacity: 0.7"' : ''}
                                ${isWeekOff(date) ? 'disabled' : ''}>
                            Present
                        </button>
                        <button class="btn btn-small ${status === 'absent' ? 'btn-danger' : 'btn-primary'}" 
                                onclick="markAttendance('${student.id}', 'absent')"
                                ${status === 'absent' ? 'style="opacity: 0.7"' : ''}
                                ${isWeekOff(date) ? 'disabled' : ''}>
                            Absent
                        </button>
                        <button class="btn btn-small ${status === 'late' ? 'btn-warning' : 'btn-primary'}" 
                                onclick="markAttendance('${student.id}', 'late')"
                                ${status === 'late' ? 'style="opacity: 0.7"' : ''}
                                ${isWeekOff(date) ? 'disabled' : ''}>
                            Late
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function refreshStudentsTable() {
            const tbody = document.getElementById('students-table');
            tbody.innerHTML = '';
            
            students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.email || '-'}</td>
                    <td>${student.department || '-'}</td>
                    <td>
                        <button class="btn btn-small btn-danger" onclick="deleteStudent('${student.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function refreshLeaveTable() {
            const tbody = document.getElementById('leave-table');
            tbody.innerHTML = '';
            
            // Update student dropdown
            const studentSelect = document.getElementById('leave-student');
            studentSelect.innerHTML = '<option value="">Select Student</option>';
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} (${student.id})`;
                studentSelect.appendChild(option);
            });
            
            leaveRecords.forEach(leave => {
                const student = students.find(s => s.id === leave.studentId);
                if (!student) return;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.name}</td>
                    <td>${leave.leaveType.charAt(0).toUpperCase() + leave.leaveType.slice(1)}</td>
                    <td>${leave.fromDate}</td>
                    <td>${leave.toDate}</td>
                    <td>${leave.days}</td>
                    <td>${leave.reason}</td>
                    <td><span class="status-${leave.status}">${leave.status.charAt(0).toUpperCase() + leave.status.slice(1)}</span></td>
                    <td>
                        ${leave.status === 'pending' ? `
                            <button class="btn btn-small btn-success" onclick="approveLeave('${leave.id}')">Approve</button>
                            <button class="btn btn-small btn-danger" onclick="rejectLeave('${leave.id}')">Reject</button>
                        ` : '-'}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function refreshRecordsTable() {
            const tbody = document.getElementById('records-table');
            tbody.innerHTML = '';
            
            let filteredRecords = [...attendanceRecords];
            
            // Apply filters
            const filterStudent = document.getElementById('filter-student').value;
            const filterDateFrom = document.getElementById('filter-date-from').value;
            const filterDateTo = document.getElementById('filter-date-to').value;
            const filterStatus = document.getElementById('filter-status').value;
            
            if (filterStudent) {
                filteredRecords = filteredRecords.filter(r => r.studentId === filterStudent);
            }
            
            if (filterDateFrom) {
                filteredRecords = filteredRecords.filter(r => r.date >= filterDateFrom);
            }
            
            if (filterDateTo) {
                filteredRecords = filteredRecords.filter(r => r.date <= filterDateTo);
            }
            
            if (filterStatus) {
                filteredRecords = filteredRecords.filter(r => r.status === filterStatus);
            }
            
            // Sort by date (newest first)
            filteredRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            filteredRecords.forEach(record => {
                const student = students.find(s => s.id === record.studentId);
                if (!student) return;
                
                const checkInOut = checkInOutRecords.find(c => 
                    c.studentId === record.studentId && c.date === record.date
                );
                
                let checkIn = '-';
                let checkOut = '-';
                let totalHours = '0:00';
                
                if (checkInOut) {
                    checkIn = checkInOut.checkIn || '-';
                    checkOut = checkInOut.checkOut || '-';
                    
                    if (checkInOut.checkIn && checkInOut.checkOut) {
                        const totalMinutes = calculateTotalMinutes(checkInOut.checkIn, checkInOut.checkOut, checkInOut.breakTime || 0);
                        totalHours = formatMinutesToHours(totalMinutes);
                    }
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.date}</td>
                    <td>${student.name} (${student.id})</td>
                    <td class="time-display">${checkIn}</td>
                    <td class="time-display">${checkOut}</td>
                    <td class="working-hours">${totalHours}</td>
                    <td><span class="status-${record.status}">${record.status.charAt(0).toUpperCase() + record.status.slice(1).replace('-', ' ')}</span></td>
                    <td>${record.class}</td>
                `;
                tbody.appendChild(row);
            });
            
            // Update filter dropdown
            const filterSelect = document.getElementById('filter-student');
            filterSelect.innerHTML = '<option value="">All Students</option>';
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} (${student.id})`;
                filterSelect.appendChild(option);
            });
        }

        function refreshReportsTable() {
            const tbody = document.getElementById('report-table');
            tbody.innerHTML = '';
            
            let totalHoursAll = 0;
            let totalWorkingDays = 0;
            
            // Calculate statistics for each student
            students.forEach(student => {
                const studentRecords = attendanceRecords.filter(r => r.studentId === student.id);
                const studentCheckInOuts = checkInOutRecords.filter(r => r.studentId === student.id);
                const studentLeaves = leaveRecords.filter(r => r.studentId === student.id && r.status === 'approved');
                
                const totalDays = studentRecords.length;
                const presentCount = studentRecords.filter(r => r.status === 'present').length;
                const absentCount = studentRecords.filter(r => r.status === 'absent').length;
                const lateCount = studentRecords.filter(r => r.status === 'late').length;
                const leaveCount = studentLeaves.reduce((sum, leave) => sum + leave.days, 0);
                
                // Calculate average working hours
                let totalMinutes = 0;
                let workingDaysCount = 0;
                
                studentCheckInOuts.forEach(record => {
                    if (record.checkIn && record.checkOut) {
                        totalMinutes += calculateTotalMinutes(record.checkIn, record.checkOut, record.breakTime || 0);
                        workingDaysCount++;
                    }
                });
                
                const avgHours = workingDaysCount > 0 ? formatMinutesToHours(totalMinutes / workingDaysCount) : '0:00';
                const attendancePercentage = totalDays > 0 ? (((presentCount + lateCount) / totalDays) * 100).toFixed(1) : 0;
                
                totalHoursAll += totalMinutes;
                totalWorkingDays += workingDaysCount;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.name} (${student.id})</td>
                    <td>${totalDays}</td>
                    <td>${presentCount}</td>
                    <td>${absentCount}</td>
                    <td>${lateCount}</td>
                    <td>${leaveCount}</td>
                    <td class="working-hours">${avgHours}</td>
                    <td>${attendancePercentage}%</td>
                `;
                tbody.appendChild(row);
            });
            
            // Update statistics cards
            document.getElementById('total-students').textContent = students.length;
            document.getElementById('total-records').textContent = attendanceRecords.length;
            
            const totalClasses = attendanceRecords.length;
            const totalPresent = attendanceRecords.filter(r => r.status === 'present' || r.status === 'late').length;
            const overallPercentage = totalClasses > 0 ? ((totalPresent / totalClasses) * 100).toFixed(1) : 0;
            document.getElementById('average-attendance').textContent = overallPercentage + '%';
            
            const today = new Date().toISOString().split('T')[0];
            const presentToday = attendanceRecords.filter(r => r.date === today && (r.status === 'present' || r.status === 'late')).length;
            document.getElementById('present-today').textContent = presentToday;
            
            const totalLeaves = leaveRecords.filter(l => l.status === 'approved').reduce((sum, leave) => sum + leave.days, 0);
            document.getElementById('total-leaves').textContent = totalLeaves;
            
            const avgHoursOverall = totalWorkingDays > 0 ? formatMinutesToHours(totalHoursAll / totalWorkingDays) : '0:00';
            document.getElementById('avg-hours').textContent = avgHoursOverall;
        }

        function refreshAllTables() {
            refreshAttendanceTable();
            refreshStudentsTable();
            refreshRecordsTable();
            refreshReportsTable();
            refreshCheckInTable();
            refreshLeaveTable();
        }

        function filterRecords() {
            refreshRecordsTable();
        }

        // Utility functions
        function calculateTotalMinutes(checkIn, checkOut, breakTime) {
            const start = new Date(`1970-01-01T${checkIn}`);
            const end = new Date(`1970-01-01T${checkOut}`);
            const workMinutes = (end - start) / 1000 / 60;
            return Math.max(0, workMinutes - breakTime);
        }

        function formatMinutesToHours(minutes) {
            if (isNaN(minutes) || minutes < 0) return '0:00';
            const hours = Math.floor(minutes / 60);
            const mins = Math.floor(minutes % 60);
            return `${hours}:${mins.toString().padStart(2, '0')}`;
        }

        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type === 'error' ? 'error' : 'success'}`;
            alert.textContent = message;
            
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 3000);
        }

        // Settings management
        function saveSettings() {
            settings.workStartTime = document.getElementById('work-start-time').value;
            settings.workEndTime = document.getElementById('work-end-time').value;
            settings.lateThreshold = parseInt(document.getElementById('late-threshold').value) || 15;
            
            settings.weekOffs = [];
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            days.forEach((day, index) => {
                if (document.getElementById(day).checked) {
                    settings.weekOffs.push(index);
                }
            });
            
            saveData();
            showAlert('Settings saved successfully', 'success');
        }

        function exportData() {
            const data = {
                students,
                attendanceRecords,
                leaveRecords,
                checkInOutRecords,
                settings,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `attendance_data_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert('Data exported successfully', 'success');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                students = [];
                attendanceRecords = [];
                leaveRecords = [];
                checkInOutRecords = [];
                saveData();
                refreshAllTables();
                showAlert('All data cleared', 'success');
            }
        }

        // Data persistence
        function saveData() {
            // In a real application, this would save to a database
        }

        function loadData() {
            // Load settings
            document.getElementById('work-start-time').value = settings.workStartTime;
            document.getElementById('work-end-time').value = settings.workEndTime;
            document.getElementById('late-threshold').value = settings.lateThreshold;
            
            // Set week off checkboxes
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            days.forEach((day, index) => {
                document.getElementById(day).checked = settings.weekOffs.includes(index);
            });
            
            // Load sample data if empty
            if (students.length === 0) {
                students = [
                    { id: 'EMP001', name: 'Alice Johnson', email: 'alice@company.com', department: 'Engineering' },
                    { id: 'EMP002', name: 'Bob Smith', email: 'bob@company.com', department: 'Marketing' },
                    { id: 'EMP003', name: 'Charlie Brown', email: 'charlie@company.com', department: 'HR' },
                    { id: 'EMP004', name: 'Diana Wilson', email: 'diana@company.com', department: 'Finance' },
                    { id: 'EMP005', name: 'Edward Davis', email: 'edward@company.com', department: 'Engineering' }
                ];
                
                // Add sample records
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                // Sample attendance records
                attendanceRecords = [
                    { studentId: 'EMP001', date: today.toISOString().split('T')[0], class: 'Daily Standup', status: 'present', timestamp: new Date().toISOString() },
                    { studentId: 'EMP002', date: today.toISOString().split('T')[0], class: 'Daily Standup', status: 'late', timestamp: new Date().toISOString() },
                    { studentId: 'EMP003', date: today.toISOString().split('T')[0], class: 'Daily Standup', status: 'absent', timestamp: new Date().toISOString() }
                ];
                
                // Sample check-in/out records
                checkInOutRecords = [
                    { studentId: 'EMP001', date: today.toISOString().split('T')[0], checkIn: '09:00', checkOut: '17:30', breakTime: 60, status: 'present' },
                    { studentId: 'EMP002', date: today.toISOString().split('T')[0], checkIn: '09:20', checkOut: null, breakTime: 0, status: 'late' },
                    { studentId: 'EMP001', date: yesterday.toISOString().split('T')[0], checkIn: '08:55', checkOut: '17:15', breakTime: 45, status: 'present' }
                ];
                
                // Sample leave records
                const nextWeek = new Date(today);
                nextWeek.setDate(nextWeek.getDate() + 7);
                
                leaveRecords = [
                    {
                        id: '1',
                        studentId: 'EMP003',
                        leaveType: 'sick',
                        fromDate: nextWeek.toISOString().split('T')[0],
                        toDate: nextWeek.toISOString().split('T')[0],
                        days: 1,
                        reason: 'Fever and cold',
                        status: 'pending',
                        appliedDate: today.toISOString().split('T')[0]
                    }
                ];
            }
        }
    </script>
</body>
</html>